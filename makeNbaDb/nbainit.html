<!DOCTYPE html>
<html>

<style>
  code {
    color: black;
  }
  pre {
    background-color: whitesmoke;
  }
</style>
<head><meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>nbainit</title><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>

<h2>Use Sportradar's NBA API to build your own database<a class="anchor-link" href="#Use-Sportradar's-NBA-API-to-build-your-own-database">&#182;</a></h2>
<h3 id="Introduction">Introduction<a class="anchor-link" href="#Introduction">&#182;</a></h3>
<p>
  My disovery of advanced statistics in sports is one of the things that led me to data science. Watching sports on TV usually 
  means putting up with a slew of tired observations and adages of questionable accuracy. It was fresh and interesting to learn 
  about concepts like value over replacement and points per possession. No one number can capture a player's impact, but 
  advanced statistics are much more useful than the other information available.
</p>
<p>
  The NBA is my favorite league and it would be very fun to do data analysis. Before that, I must do the less glamorous task of 
  preparing the data. Which, according to <a href="https://www.anaconda.com/state-of-data-science-2020">some estimates</a>, is 45% 
  of a data scientist's working hours. I identified the <a href="https://developer.sportradar.com/docs/read/basketball/NBA_v7">sportradar API</a> 
  as an option for data. However, a SQL database would be much more appealing for the data combinations, custom statistics, and other work that would 
  require the data in tabular format. Additionally, we have to consider the cost of requesting data from an API so frequently.
</p>
<p>Currently, I have been able to create two tables in my NBA database: the schedules table and the seasons table. In this post, I will show how I:</p>
<ol>
  <li>Connected to the sportradar API</li>
  <li>Downloaded NBA season and schedule data</li>
  <li>Flattened the data and load it into a relational database</li>
  <li>Developed procedures for updates that only download what is necessary</li>
</ol>
<p>Oh, and a final personal note: this is my first Python post! I will be doing more of these moving forward.</p>

<h3 id="Pre-requisites">Pre-requisites<a class="anchor-link" href="#Pre-requisites">&#182;</a></h3>
<ol>
  <li>A <a href="https://developer.sportradar.com/docs/read/basketball/NBA_v7">sportradar API</a> key</li>
  <li>A SQL database that you have successfully connected to and can modify. A tutorial to create and connect to an Azure SQL database in Python can be found <a href="https://docs.microsoft.com/en-us/azure/azure-sql/database/connect-query-python?view=azuresql">here</a>.</li>
  <li>Python and all packages used in the post</li>
  <li>(Optional) Some familiarity with environment variables</li>
  <li>(Optional) An Azure KeyVault account. See how to get set up and interact with Azure KeyVault via Python <a href="https://docs.microsoft.com/en-us/azure/key-vault/secrets/quick-create-python?tabs=azure-cli">here</a>.</li>
</ol>
<h3 id="Getting-set-up">Getting set up<a class="anchor-link" href="#Getting-set-up">&#182;</a></h3>
<p>
  To begin, let's load the packages and specify the folder paths we will be using. Like previous posts, I will 
  be using a JSON configuration file and environment variables to define many of these things. It keeps information private 
  while still letting me share the fun parts. Additionally, there are a few custom functions from my 
  main development project. Functions from that module connect to the database and my key vault account.
</p>
<p>
  The calls to <code>importlib</code> and <code>types</code> allow me to import the <code>myFuns</code> module I have been 
  coding in my main project folder. It is appropriately named: myFuns has all of the functions I have been using to build the database, including connections and secret handling. If you'd prefer not mess with those sorts of things, define the following variables to proceed:</p>
<ol>
  <li>An object <code>srNBAKey</code> that is your sportsradar API key for the NBA v7 API</li>
  <li>An object <code>cnxn</code> that is your connection to the SQL database engine</li>
  <li>An object <code>nbaDir</code> that will house the downloaded JSON files</li>
</ol>

<p>Now, let's run the code to set up our session:</p>

<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># SETUP</span>
<span class="c1"># Import standard packages</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">importlib.machinery</span><span class="o">,</span> <span class="nn">http.client</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span><span class="o">,</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sqlalchemy</span>
<span class="kn">import</span> <span class="nn">importlib</span><span class="o">,</span> <span class="nn">types</span> <span class="c1"># Only needed if loading custom module</span>

<span class="c1"># Read in Python config file</span>
<span class="n">cfFn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"myconfig"</span><span class="p">],</span> <span class="s2">"nba.json"</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfFn</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># Source custom functions</span>
<span class="n">myFunsFn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cf</span><span class="p">[</span><span class="s2">"nbaFunsDir"</span><span class="p">],</span> <span class="s2">"myFuns/__init__.py"</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cf</span><span class="p">[</span><span class="s2">"nbaFunsDir"</span><span class="p">])</span>
<span class="kn">from</span> <span class="nn">myFuns.cloud</span> <span class="kn">import</span> <span class="n">secman</span>

<span class="c1"># Get NBA API key from Azure and connect to SQL db</span>
<span class="n">seccli</span> <span class="o">=</span> <span class="n">secman</span><span class="o">.</span><span class="n">secretClient</span><span class="p">()</span>
<span class="n">srNBAKey</span> <span class="o">=</span> <span class="n">seccli</span><span class="o">.</span><span class="n">get_secret</span><span class="p">(</span><span class="s2">"srNBAKey"</span><span class="p">)</span>
<span class="n">cnxn</span> <span class="o">=</span> <span class="n">secman</span><span class="o">.</span><span class="n">dbEngine</span><span class="p">(</span><span class="n">seccli</span><span class="p">)</span>

<span class="c1"># Specify directories for output</span>
<span class="n">nbaDir</span> <span class="o">=</span> <span class="s2">"D:/nbaBlog"</span>
<span class="n">schedDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nbaDir</span><span class="p">,</span> <span class="s2">"schedules"</span><span class="p">)</span>
<span class="c1"># os.makedirs(schedDir)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Wonderful! We have our API key ready to go and we are connected to our database. Now, let's explore the sportradar API.</p>
<h3 id="Explore-the-API">Explore the API<a class="anchor-link" href="#Explore-the-API">&#182;</a></h3><p>When you navigate to the <a href="https://developer.sportradar.com/docs/read/basketball/NBA_v7#nba-api-map">API main page</a>, you will be greeted with this image:</p>
<p><img src="https://developer.sportradar.com/files/NBAv7SVG.svg" alt="sportradar API diagram" /></p>
<p>Quite helpful! Today, we will be working with the Schedule and Seasons endpoints. Let's take a peek at the data. We will start an https connection, send a get request with our API key, and load the JSON payload.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Get list of available seasons</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPSConnection</span><span class="p">(</span><span class="s2">"api.sportradar.us"</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">suffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"/nba/trial/v7/en/league/seasons.json?api_key=</span><span class="si">{</span><span class="n">srNBAKey</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span>
<span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">"GET"</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">allSeasons</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="s1">'seasons'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">allSeasons</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>[
  {
    &#34;id&#34;: &#34;5b8b57d1-7290-44f8-b29c-353e865c139e&#34;,
    &#34;year&#34;: 2012,
    &#34;type&#34;: {
      &#34;code&#34;: &#34;PRE&#34;,
      &#34;name&#34;: &#34;Pre-season&#34;
    }
  },
  {
    &#34;id&#34;: &#34;5f45c666-ba68-48d6-a905-f19702ab7e4c&#34;,
    &#34;year&#34;: 2012,
    &#34;type&#34;: {
      &#34;code&#34;: &#34;PST&#34;,
      &#34;name&#34;: &#34;Post-season&#34;
    }
  }
]
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>The schedule has games for the pre-season, post-season, and regular season. Each season has a unique ID and year. Next, let's pull one of these seasons and look at its schedule. We will need the year and type of a season to pull it's schedule.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Get year and season type for first listed</span>
<span class="n">year</span> <span class="o">=</span> <span class="n">allSeasons</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">"year"</span><span class="p">]</span>
<span class="n">seasonType</span> <span class="o">=</span> <span class="n">allSeasons</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">"type"</span><span class="p">][</span><span class="s2">"code"</span><span class="p">]</span>

<span class="c1"># Pull the data, convert to JSON object</span>
<span class="c1"># Add some rests to prevent errors</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPSConnection</span><span class="p">(</span><span class="s2">"api.sportradar.us"</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">"GET"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"/nba/trial/v7/en/games/</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">seasonType</span><span class="si">}</span><span class="s2">/schedule.json?api_key=</span><span class="si">{</span><span class="n">srNBAKey</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">testSched</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf8"</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>[]
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="Design-the-database-tables">Design the database tables<a class="anchor-link" href="#Design-the-database-tables">&#182;</a></h3><p>Now that we have our two file formats, we can start to think through a database design. Reading through the docs, it seems the table design is not <a href="https://docs.microsoft.com/en-us/office/troubleshoot/access/database-normalization-description">normalized</a>. For example, there is a team profile API endpoint containing most of the team information included in the <code>home</code> and <code>away</code> entries, so the same information is being presented multiple times. This makes sense: it likely reduces the number of API calls for most users. Still, this underscores the point that the optimal database design is not the same as the optimal API design. We are not working with a particularly sizable dataset, so it should be easy to rebuild the database if we want to change the design later.</p>
<p>After some initial experimentation, I decided that these were the variables I wanted:</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cnxn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">DROP TABLE IF EXISTS scheduleBLOG;</span>
<span class="s2">CREATE TABLE scheduleBLOG (</span>
<span class="s2">    schedId varchar(100) PRIMARY KEY        </span>
<span class="s2">    , srMatchId varchar(100)</span>
<span class="s2">    , schedDt DATETIME</span>
<span class="s2">    , homePoints int</span>
<span class="s2">    , awayPoints int</span>
<span class="s2">    , coverage varchar(50)</span>
<span class="s2">    , status varchar(50)    </span>
<span class="s2">    , trackOnCourt varchar(20)</span>
<span class="s2">    , IdHome varchar(100)</span>
<span class="s2">    , srIdHome varchar(100)</span>
<span class="s2">    , nameHome varchar(100)</span>
<span class="s2">    , aliasHome varchar(100)</span>
<span class="s2">    , IdAway varchar(100)</span>
<span class="s2">    , srIdAway varchar(100)</span>
<span class="s2">    , nameAway varchar(100)</span>
<span class="s2">    , aliasAway varchar(100)</span>
<span class="s2">    , seasonId VARCHAR(100) NOT NULL </span>
<span class="s2">    , createDt DATETIME DEFAULT CURRENT_TIMESTAMP</span>
<span class="s2">    , updatedDt DATETIME     </span>
<span class="s2">);</span>

<span class="s2">DROP TABLE IF EXISTS seasonBLOG;</span>
<span class="s2">CREATE TABLE seasonBLOG (</span>
<span class="s2">    seasonId VARCHAR(100) NOT NULL PRIMARY KEY</span>
<span class="s2">    , seasonType varchar(10) NOT NULL</span>
<span class="s2">    , seasonYear int NOT NULL</span>
<span class="s2">    , createDt DATETIME DEFAULT CURRENT_TIMESTAMP</span>
<span class="s2">    , updatedDt DATETIME</span>
<span class="s2">);</span>

<span class="s2">ALTER TABLE scheduleBLOG</span>
<span class="s2">ADD CONSTRAINT FK_seasonIdBLOG</span>
<span class="s2">FOREIGN KEY (seasonId) REFERENCES seasonBLOG(seasonId)</span>
<span class="s2">"""</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child jp-OutputArea-executeResult">
    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[&nbsp;]:</div>




<div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
<pre>&lt;sqlalchemy.engine.cursor.LegacyCursorResult at 0x6b5a0e8&gt;</pre>
</div>

</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>We will use the sportradar identifiers as our primary keys in the database for now. We will allow some missing data in the schedule table. After we ingest all of the data, we can think more thoroughly about other constraints to add.</p>
<p>The <a href="https://www.techopedia.com/definition/7272/foreign-key#:~:text=A%20foreign%20key%20is%20a,establishing%20a%20link%20between%20them.">foreign key</a> constraint lets our database know that the schedule and season tables share a common identifier, <code>seasonId</code>. That adds some built-in data quality checks. For example, it would not allow you to enter a <code>seasonId</code> in the <code>schedules</code> table unless that ID were in the <code>season</code> table. Formalizing these sorts of relationships help others quickly understand how your database is designed.</p>
<h3 id="Download-Data">Download Data<a class="anchor-link" href="#Download-Data">&#182;</a></h3><p>Now that we have explored the data and created our database tables, we will write code to download all data in JSON format and save it in an organized fashion. All files will be named by the convention <code>schedTYPEYYYY.json</code> (e.g. <code>schedPRE2022</code>). We also want to avoid re-downloading data and making unnecessary API calls. The <code>os.path.exists</code> function comes in quite handy. I have already downloaded most of the data, but for the sake of this blog I will delete a few schedules and run the function.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Turn a schedule retrieval into a fnxn</span>
<span class="k">def</span> <span class="nf">getSchedule</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">seasonType</span><span class="p">,</span> <span class="n">apiKey</span><span class="p">):</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPSConnection</span><span class="p">(</span><span class="s2">"api.sportradar.us"</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>    
    <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">"GET"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"/nba/trial/v7/en/games/</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">seasonType</span><span class="si">}</span><span class="s2">/schedule.json?api_key=</span><span class="si">{</span><span class="n">apiKey</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>    
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf8"</span><span class="p">))</span>

<span class="c1"># Download each season if its key is not yet in the database</span>
<span class="c1"># Template names based on season type and year</span>
<span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="n">allSeasons</span><span class="p">:</span>         
    <span class="n">year</span> <span class="o">=</span> <span class="n">season</span><span class="p">[</span><span class="s2">"year"</span><span class="p">]</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">season</span><span class="p">[</span><span class="s2">"type"</span><span class="p">][</span><span class="s2">"code"</span><span class="p">]</span>
    <span class="n">fileName</span> <span class="o">=</span> <span class="s2">"sched"</span> <span class="o">+</span> <span class="nb">type</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s2">".json"</span>
    <span class="n">outpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">schedDir</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span>

    <span class="c1"># Only download file if we have not already    </span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outpath</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"downloading "</span><span class="o">+</span> <span class="n">fileName</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">seas</span> <span class="o">=</span> <span class="n">getSchedule</span><span class="p">(</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span><span class="p">,</span> <span class="n">seasonType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">,</span> <span class="n">apiKey</span> <span class="o">=</span> <span class="n">srNBAKey</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>               
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">seas</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>downloading schedPST2014.json
downloading schedPST2015.json
downloading schedPST2016.json
downloading schedPRE2022.json
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="Upload-Data">Upload Data<a class="anchor-link" href="#Upload-Data">&#182;</a></h3><p>Now, we put the data we just downloaded into our database. It will be easiest to rename the JSON data elements to match their SQL-database counterparts. To do that, we use our trustry old friend, the JSON file. The dictionary keys will be the SR API names, and the values our desired values. The JSON file looks like this:</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># JSON file with schedionaries for renaming raw to SQL column names</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"renameVars.json"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">renames</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">renames</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>{
  &#34;schedule&#34;: {
    &#34;id&#34;: &#34;schedId&#34;,
    &#34;sr_id&#34;: &#34;srMatchId&#34;,
    &#34;scheduled&#34;: &#34;schedDt&#34;,
    &#34;home_points&#34;: &#34;homePoints&#34;,
    &#34;away_points&#34;: &#34;awayPoints&#34;,
    &#34;coverage&#34;: &#34;coverage&#34;,
    &#34;status&#34;: &#34;status&#34;,
    &#34;track_on_court&#34;: &#34;trackOnCourt&#34;,
    &#34;idHome&#34;: &#34;idHome&#34;,
    &#34;sr_idHome&#34;: &#34;srIdHome&#34;,
    &#34;nameHome&#34;: &#34;nameHome&#34;,
    &#34;aliasHome&#34;: &#34;aliasHome&#34;,
    &#34;idAway&#34;: &#34;idAway&#34;,
    &#34;sr_idAway&#34;: &#34;srIdAway&#34;,
    &#34;nameAway&#34;: &#34;nameAway&#34;,
    &#34;aliasAway&#34;: &#34;aliasAway&#34;
  },
  &#34;season&#34;: {
    &#34;id&#34;: &#34;seasonId&#34;,
    &#34;type&#34;: &#34;seasonType&#34;,
    &#34;year&#34;: &#34;seasonYear&#34;
  }
}
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>And with that, we should have everything we need to populate our database tables! For both games and seasons, we will want to make sure the record has not been entered before. It also seems there are some seasons with no data available, so the case where the JSON file is empty will need to be handled.</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">games</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">"SELECT DISTINCT schedId FROM scheduleBLOG"</span><span class="p">,</span> <span class="n">cnxn</span><span class="p">)</span>
<span class="n">seasons</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">"SELECT DISTINCT seasonId FROM seasonBLOG"</span><span class="p">,</span> <span class="n">cnxn</span><span class="p">)</span>

<span class="c1">####################################################</span>
<span class="c1"># MAKE ROWS</span>
<span class="c1">####################################################</span>
<span class="c1"># Get all of our schedule JSON files</span>
<span class="n">fns</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">schedDir</span><span class="p">)</span>

<span class="c1"># Loop through each schedule year and add to db</span>
<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">fns</span><span class="p">:</span>     
    <span class="c1"># Open file, determine year</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">schedDir</span><span class="p">,</span> <span class="n">fn</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">sched</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">seas</span> <span class="o">=</span> <span class="p">{</span><span class="n">renames</span><span class="p">[</span><span class="s2">"season"</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sched</span><span class="p">[</span><span class="s1">'season'</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>    
    <span class="n">season</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">seas</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Have we loaded this season before?</span>
    <span class="n">newseason</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">season</span><span class="p">[</span><span class="s1">'seasonId'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">seasons</span><span class="p">[</span><span class="s1">'seasonId'</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">newseason</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Adding Season "</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
        <span class="n">season</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">'seasonBLOG'</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">cnxn</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s1">'append'</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># If no games, skip</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sched</span><span class="p">[</span><span class="s1">'games'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No games in list "</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="c1"># Loop through games, extract values into dictionary</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>    
    <span class="k">for</span> <span class="n">game</span> <span class="ow">in</span> <span class="n">sched</span><span class="p">[</span><span class="s1">'games'</span><span class="p">]:</span>
        <span class="n">newgame</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">game</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="ow">in</span> <span class="n">games</span><span class="p">[</span><span class="s1">'schedId'</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">newgame</span><span class="p">:</span>
            <span class="c1"># Variables of interest from parent values</span>
            <span class="n">parentKeep</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'sr_id'</span><span class="p">,</span> <span class="s1">'status'</span><span class="p">,</span> <span class="s1">'coverage'</span><span class="p">,</span> <span class="s1">'scheduled'</span><span class="p">,</span> \
                <span class="s1">'track_on_court'</span><span class="p">,</span> <span class="s1">'home_points'</span><span class="p">,</span> <span class="s1">'away_points'</span><span class="p">}</span>
            <span class="n">parentValues</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parentKeep</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">game</span><span class="p">}</span>

            <span class="c1"># We want the same values from "home" and "away" subdicts</span>
            <span class="n">teamKeep</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"sr_id"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">,</span> <span class="s2">"alias"</span><span class="p">}</span>
            <span class="n">homeValues</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">+</span> <span class="s1">'Home'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="s1">'home'</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">teamKeep</span> \
                <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">game</span><span class="p">[</span><span class="s1">'home'</span><span class="p">]}</span>
            <span class="n">awayValues</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="o">+</span> <span class="s1">'Away'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="s1">'away'</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">teamKeep</span> \
                <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">game</span><span class="p">[</span><span class="s1">'away'</span><span class="p">]}</span>

            <span class="c1"># Combine all dicts, rename according to renaming dictionary</span>
            <span class="c1"># Use None-type if variable is not present</span>
            <span class="n">comb</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">parentValues</span><span class="p">,</span> <span class="o">**</span><span class="n">homeValues</span><span class="p">,</span> <span class="o">**</span><span class="n">awayValues</span><span class="p">}</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="n">renames</span><span class="p">[</span><span class="s2">"schedule"</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">comb</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">notIn</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">renames</span><span class="p">[</span><span class="s1">'schedule'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notIn</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">pass</span>

    <span class="c1"># Convert all of our dicts to a DF, then load to DB</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"loading "</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">toLoad</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">toLoad</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">toLoad</span><span class="p">[</span><span class="s1">'schedDt'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">toLoad</span><span class="p">[</span><span class="s1">'schedDt'</span><span class="p">])</span>
        <span class="n">toLoad</span><span class="p">[</span><span class="s1">'seasonId'</span><span class="p">]</span> <span class="o">=</span> <span class="n">season</span><span class="p">[</span><span class="s1">'seasonId'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>        
        <span class="n">toLoad</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s1">'scheduleBLOG'</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">cnxn</span><span class="p">,</span> <span class="n">if_exists</span> <span class="o">=</span> <span class="s1">'append'</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> \
            <span class="n">dtype</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"schedDt"</span><span class="p">:</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">DateTime</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"skipping "</span> <span class="o">+</span> <span class="n">fn</span> <span class="o">+</span> <span class="s2">"due to no new records"</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>loading schedPRE2012.json
skipping schedPRE2012.jsondue to no new records
loading schedREG2012.json
skipping schedREG2012.jsondue to no new records
loading schedREG2013.json
Adding Season schedPRE2014.json
loading schedPRE2014.json
Adding Season schedREG2014.json
loading schedREG2014.json
Adding Season schedPRE2015.json
loading schedPRE2015.json
Adding Season schedREG2015.json
loading schedREG2015.json
Adding Season schedPRE2016.json
loading schedPRE2016.json
Adding Season schedREG2016.json
loading schedREG2016.json
Adding Season schedPRE2017.json
loading schedPRE2017.json
Adding Season schedPST2017.json
loading schedPST2017.json
Adding Season schedREG2017.json
loading schedREG2017.json
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Let's make sure that worked. We will query the tables we loaded to and print out a few rows. Did it work? Did it fail? The suspense! The intrigue!</p>

</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[&nbsp;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Read in our newly loaded data</span>
<span class="n">games</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">"SELECT TOP 10 * FROM scheduleBLOG"</span><span class="p">,</span> <span class="n">cnxn</span><span class="p">)</span>
<span class="n">seasons</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">"SELECT TOP 10 * FROM seasonBLOG"</span><span class="p">,</span> <span class="n">cnxn</span><span class="p">)</span>

<span class="c1"># Print a few games out</span>
<span class="nb">print</span><span class="p">(</span><span class="n">games</span><span class="p">)</span>
<span class="c1"># And a few seasons</span>
<span class="nb">print</span><span class="p">(</span><span class="n">seasons</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>


<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>                                schedId          srMatchId  \
0  000193f7-3433-461a-b562-7f7c69e8023f               None   
1  000477ca-9053-4bdf-857b-629ebc8e670e  sr:match:24750712   
2  00096a31-9afb-4d89-957f-2ca5741f813c  sr:match:12233334   
3  000bee26-0d7f-451e-b2c3-b52f24581c7f   sr:match:7790366   
4  000e7d9f-7fa0-4273-a419-e02a95cd6101   sr:match:9956289   
5  0010abb3-bf15-401a-97fd-a20d7f45ef3b               None   
6  00189aa2-fe36-420e-b3a1-7d9dbd8846a1  sr:match:28808730   
7  001b86bd-1891-462f-8d0b-c373434d4f14  sr:match:15327444   
8  001da480-f3ad-4da4-a72b-9899f2394672  sr:match:28809934   
9  001eaa7b-4a2d-4077-b590-1f288a42a8a2   sr:match:4194739   

              schedDt  homePoints  awayPoints coverage     status  \
0 2023-04-08 00:30:00         NaN         NaN     full  scheduled   
1 2021-02-27 03:00:00       130.0       121.0     full     closed   
2 2017-12-14 00:00:00        95.0       106.0     full     closed   
3 2015-10-31 00:00:00       113.0       118.0     full     closed   
4 2017-01-21 01:00:00       107.0        91.0     full     closed   
5 2023-02-04 02:00:00         NaN         NaN     full  scheduled   
6 2022-01-03 00:00:00        99.0       133.0     full     closed   
7 2018-11-01 00:00:00       128.0       125.0     full     closed   
8 2022-02-17 00:30:00       113.0       108.0     full     closed   
9 2014-02-09 20:30:00        86.0        92.0     full     closed   

  trackOnCourt                                IdHome      srIdHome  \
0            1  583ecf50-fb46-11e1-82cb-f4ce4684ea4c  sr:team:3411   
1            1  583ec825-fb46-11e1-82cb-f4ce4684ea4c  sr:team:3428   
2            1  583ed157-fb46-11e1-82cb-f4ce4684ea4c  sr:team:3437   
3         None  583ecefd-fb46-11e1-82cb-f4ce4684ea4c  sr:team:3410   
4         None  583eca88-fb46-11e1-82cb-f4ce4684ea4c  sr:team:3415   
5            1  583ece50-fb46-11e1-82cb-f4ce4684ea4c  sr:team:3434   
6            1  583ec97e-fb46-11e1-82cb-f4ce4684ea4c  sr:team:3430   
7            1  583eca2f-fb46-11e1-82cb-f4ce4684ea4c  sr:team:3426   
8            1  583ec7cd-fb46-11e1-82cb-f4ce4684ea4c  sr:team:3419   
9         None  583ecae2-fb46-11e1-82cb-f4ce4684ea4c  sr:team:3427   

                 nameHome aliasHome                                IdAway  \
0        Dallas Mavericks       DAL  583ec5fd-fb46-11e1-82cb-f4ce4684ea4c   
1   Golden State Warriors       GSW  583ec97e-fb46-11e1-82cb-f4ce4684ea4c   
2           Orlando Magic       ORL  583ecdfb-fb46-11e1-82cb-f4ce4684ea4c   
3         Milwaukee Bucks       MIL  583ec8d4-fb46-11e1-82cb-f4ce4684ea4c   
4       Memphis Grizzlies       MEM  583ed0ac-fb46-11e1-82cb-f4ce4684ea4c   
5               Utah Jazz       UTA  583ecb8f-fb46-11e1-82cb-f4ce4684ea4c   
6       Charlotte Hornets       CHA  583ecfa8-fb46-11e1-82cb-f4ce4684ea4c   
7  Minnesota Timberwolves       MIN  583ece50-fb46-11e1-82cb-f4ce4684ea4c   
8          Indiana Pacers       IND  583ec8d4-fb46-11e1-82cb-f4ce4684ea4c   
9      Los Angeles Lakers       LAL  583ec5fd-fb46-11e1-82cb-f4ce4684ea4c   

       srIdAway              nameAway aliasAway  \
0  sr:team:3409         Chicago Bulls       CHI   
1  sr:team:3430     Charlotte Hornets       CHA   
2  sr:team:3425  Los Angeles Clippers       LAC   
3  sr:team:3431    Washington Wizards       WAS   
4  sr:team:3413      Sacramento Kings       SAC   
5  sr:team:3423         Atlanta Hawks       ATL   
6  sr:team:3416          Phoenix Suns       PHX   
7  sr:team:3434             Utah Jazz       UTA   
8  sr:team:3431    Washington Wizards       WAS   
9  sr:team:3409         Chicago Bulls       CHI   

                               seasonId                createDt updatedDt  
0  5027b6ac-731c-4622-8d69-d863ae7c626b 2022-08-27 15:49:00.720      None  
1  feb33381-9dbf-45b6-82c1-3c50c9a2b5ce 2022-08-27 15:44:13.270      None  
2  7dcb5184-ab33-49fe-bd18-c4ca2b1cfc08 2022-08-27 15:38:09.937      None  
3  698590c2-3579-4d4e-a931-3d6dff427ee2 2022-08-27 15:33:34.293      None  
4  03241c9e-731b-40d0-a36f-bcc9932d055b 2022-08-27 15:36:22.680      None  
5  5027b6ac-731c-4622-8d69-d863ae7c626b 2022-08-27 15:48:26.633      None  
6  16d6292c-25c6-4487-aa90-912c1e09170b 2022-08-27 15:46:14.807      None  
7  47c9979e-5c3f-453d-ac75-734d17412e3f 2022-08-27 15:39:43.703      None  
8  16d6292c-25c6-4487-aa90-912c1e09170b 2022-08-27 15:46:41.780      None  
9  5ddc217a-a958-4616-9bdf-e081022c440b 2022-08-27 15:30:33.110      None  
                               seasonId seasonType  seasonYear  \
0  03241c9e-731b-40d0-a36f-bcc9932d055b        REG        2016   
1  16d6292c-25c6-4487-aa90-912c1e09170b        REG        2021   
2  191e5d0e-ad55-43ef-995c-317ae9ea1213        REG        2019   
3  1e20b802-0e4c-49f2-8045-f02a8105a71e        REG        2012   
4  22ae1aa6-d28a-452f-b6ce-c120e03c6b7d        PST        2013   
5  269501e2-f4fa-4328-ab65-4bafa7889f29        PRE        2017   
6  31dbd74e-7b42-4b97-ae0f-a4e71a4221c4        PST        2018   
7  47c9979e-5c3f-453d-ac75-734d17412e3f        REG        2018   
8  5027b6ac-731c-4622-8d69-d863ae7c626b        REG        2022   
9  529bed34-5a8d-46d4-9eef-114bd1340867        PST        2015   

                 createDt updatedDt  
0 2022-08-27 15:35:29.337      None  
1 2022-08-27 15:45:29.320      None  
2 2022-08-27 15:41:25.947      None  
3 2022-08-27 15:29:06.253      None  
4 2022-08-27 15:49:34.753      None  
5 2022-08-27 15:37:17.050      None  
6 2022-08-27 15:39:23.943      None  
7 2022-08-27 15:39:34.297      None  
8 2022-08-27 15:47:20.983      None  
9 2022-08-27 15:50:13.280      None  
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Looks to have worked. Eventually, a custom primary key that sorts chronologically would be nice. But, we have a good prototype to work with. We can now download some game/season statistic data and start having some real fun in the coming weeks and months. At least it will give me something to do this NBA season while I nervously wait for Chet Holmgren to <a href="https://theathletic.com/3535418/2022/08/24/thunder-chet-holmgren-out-for-season-lisfranc-injury/">heal from his severe foot injury</a>. Feel better soon, Chet!</p>

</div>
</div>
</div>
</div>
</body>
</html>
